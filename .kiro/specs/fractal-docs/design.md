# 设计文档

## 概述

Fractal Docs 是一个 **Kiro Spec**，用户将其复制到自己的项目后，让 AI 执行 tasks.md 中的任务，自动生成适配项目的文档系统配置。

核心思想：不是提供静态模板让用户复制，而是让 AI 分析用户项目后动态生成配置。

## 架构

### Spec 驱动的设计

```
用户项目
├── .kiro/specs/fractal-docs/     # 从 fractal-docs 复制过来
│   ├── requirements.md           # 需求文档
│   ├── design.md                 # 设计文档
│   └── tasks.md                  # 任务列表（AI 执行这个）
│
└── [AI 执行 tasks.md 后生成]
    ├── .kiro/steering/           # Kiro 规则
    │   ├── doc-maintenance.md
    │   └── project-structure.md
    ├── .kiro/templates/          # 文档模板
    │   ├── folder-readme.md
    │   └── file-header-*.txt
    ├── src/*/README.md           # 核心目录索引
    └── [其他编辑器配置]          # 根据用户选择
```

### 工作流程

```
┌─────────────────────────────────┐
│ 1. 用户复制 spec 到项目         │
│    cp -r fractal-docs/.kiro/    │
│    specs/fractal-docs your/.kiro│
│    /specs/                      │
└────────────┬────────────────────┘
             │
             ▼
┌─────────────────────────────────┐
│ 2. 在 Kiro 中打开 tasks.md      │
│    让 AI 执行任务               │
└────────────┬────────────────────┘
             │
             ▼
┌─────────────────────────────────┐
│ 3. AI 分析项目结构              │
│    - 扫描目录                   │
│    - 识别技术栈                 │
│    - 确认核心目录               │
└────────────┬────────────────────┘
             │
             ▼
┌─────────────────────────────────┐
│ 4. AI 生成适配的配置            │
│    - steering 规则              │
│    - 文档模板                   │
│    - 目录索引                   │
└────────────┬────────────────────┘
             │
             ▼
┌─────────────────────────────────┐
│ 5. 系统开始工作                 │
│    AI 修改代码时自动维护文档    │
└─────────────────────────────────┘
```

## 多编辑器支持

| 编辑器 | 配置位置 | 文件引用语法 |
|--------|----------|--------------|
| Kiro | `.kiro/steering/` | `#[[file:path]]` |
| Cursor | `.cursor/rules/` | `@filename` |
| Claude Code | `CLAUDE.md` + `.claude/rules/` | `@path/to/file` |
| Windsurf | `.windsurfrules` | 不支持 |
| Copilot | `.github/copilot-instructions.md` | 不支持 |
| Cline | `.clinerules` | 不支持 |

## 核心组件

### 1. doc-maintenance 规则

强制 AI 在修改代码时执行文档维护：
- 步骤 0: 先读取现有文档（防止覆盖）
- 步骤 1: 更新文件头部注释
- 步骤 2: 更新文件夹 README.md
- 步骤 3: 检查上级目录
- 步骤 4: 输出维护报告

### 2. project-structure 导航

通过文件引用自动加载核心目录的 README.md，让 AI 快速了解项目结构。

### 3. 文档模板

- `folder-readme.md`: 文件夹 README 模板
- `file-header-*.txt`: 各语言的文件头部注释模板

### 4. 自指机制

文档中包含更新提醒，形成自维护循环：
- `<!-- 一旦我所属的文件夹有所变化，请更新我 -->`
- `// 一旦我被更新，务必更新我的开头注释，以及所属的文件夹的 README.md`

## 与静态模板的区别

| 方面 | 静态模板 | Spec 方式 |
|------|----------|-----------|
| 安装 | 复制文件 | 复制 spec，让 AI 执行 |
| 定制 | 手动修改 | AI 自动适配 |
| 目录引用 | 手动填写 | AI 分析后生成 |
| 技术栈 | 手动选择模板 | AI 识别后选择 |
| 灵活性 | 低 | 高 |

## 已知问题与解决方案

### 问题 1: AI 不读取现有文档直接覆盖

**解决方案**: 在规则中明确添加"步骤 0: 先读取现有文档"，强调禁止直接覆盖。

### 问题 2: 自指提醒是注释，不是执行指令

**解决方案**: 自指提醒配合强制规则使用。关键是确保所有需要维护的目录都被引用到 project-structure.md 中。
